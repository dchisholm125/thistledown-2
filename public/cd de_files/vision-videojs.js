!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VISION=t()}(this,(function(){"use strict";const e=()=>`${Date.now()}-${Math.floor(1e13*Math.random())}`,t=(e,t)=>{const i=e.concat(t),s=i.length;let n=[7,11],a=[71,173];const r=[2277735313,289559509],o=[1291169091,658871167];for(let e=0;e<s;e++)n=[(n[0]<<5)-n[0]+i.charCodeAt(e),(n[1]<<3)-n[1]+i.charCodeAt(e)],a=[(a[0]<<4)-a[0]+i.charCodeAt(e),(a[1]<<6)-a[1]+i.charCodeAt(e)],n=[n[0]^r[0],n[1]^r[1]],a=[a[0]^o[0],a[1]^o[1]];return`00000000${(n[0]>>>0).toString(16)}`.slice(-8)+`00000000${(n[1]>>>0).toString(16)}`.slice(-8)+`00000000${(a[0]>>>0).toString(16)}`.slice(-8)+`00000000${(a[1]>>>0).toString(16)}`.slice(-8)},i=(e,t)=>!!t&&t.split(",").reduce(((e,t)=>((t=t.replace(/\(.*\)/g,"").trim())&&e.push(t),e)),[]).indexOf(e.replace(/\(.*\)/g,"").trim())>-1,s=e=>{const t=new ArrayBuffer(e.length),i=new Uint8Array(t);for(let t=0,s=e.length;t<s;t++)i[t]=e.charCodeAt(t);return t};class n{constructor(e,t){this.callback=e,this.adCount=1,this.adStartTime=0,this.adTimeSpent=0,this.previousAdTimeSpent=0,this.previousTimeSpent=0,this.startTime=0,this.timeSpent=0,t.subscribe((()=>this.config=t.getState())),this.config=t.getState()}createMediaSession(t){this.sessionId||(t.event_name=t.event_name.replace("_play","_start"),this.sessionId=e(),this.dispatch(Object.assign(Object.assign({},t),{event_name:"media_init"})))}dispatch(e,t=!1,i){let s=(t&&i?i:this.adTimeSpent)/1e3||0,n=(!t&&i?i:this.timeSpent)/1e3||0;const a=Date.now();if(t&&Math.abs(this.previousAdTimeSpent-s)>this.config.mediaAdHeartbeatSec+1)s=this.previousAdTimeSpent+this.config.mediaAdHeartbeatSec,this.adTimeSpent=1e3*s,this.adStartTime=a;else if(!t){const t=this.getHeartbeatInterval(e);Math.abs(this.previousTimeSpent-n)>t+1&&(n=this.previousTimeSpent+t,this.timeSpent=1e3*n,this.startTime=a)}this.previousAdTimeSpent=s,this.previousTimeSpent=n,this.callback(Object.assign(Object.assign({},e),{event_timestamp:a,media_ad_time_spent:s,media_session_id:this.sessionId,media_time_spent:n}))}dispatchMediaAdStop(e){const t=JSON.parse(e);t.event_name="media_ad_stop",this.dispatch(t,!0),this.adTimeSpent=0,this.previousAdTimeSpent=0,this.timeSpent=0,this.previousTimeSpent=0,this.adStartTime=0,this.sessionId=void 0}dispatchMediaStop(e){const t=JSON.parse(e);t.event_name="media_stop",this.adCount=1,this.dispatch(t),this.adTimeSpent=0,this.previousAdTimeSpent=0,this.timeSpent=0,this.previousTimeSpent=0,this.startTime=0,this.adStartTime=0,this.sessionId=void 0}getHeartbeatInterval({media_content_length:e}){return(null!=e?e:1/0)<this.config.mediaLengthShortSec?this.config.mediaHeartbeatShortSec:(null!=e?e:1/0)<this.config.mediaLengthMediumSec?this.config.mediaHeartbeatMediumSec:this.config.mediaHeartbeatLongSec}handleEvent(e){const t=Date.now();switch(e.event_name){case"media_ad_pause":if(!this.sessionId)return;window.clearInterval(this.adHeartbeatIntervalId),this.setAdPauseTimeout(e),this.adTimeSpent+=t-this.adStartTime,this.adStartTime=0,this.dispatch(e,!0);break;case"media_ad_play":window.clearTimeout(this.adPauseTimeoutId),this.createMediaSession(e),this.setAdHeartbeatInterval(e),this.adStartTime=t,this.dispatch(e,!0);break;case"media_ad_skipped":if(!this.sessionId)return;window.clearInterval(this.adHeartbeatIntervalId),window.clearTimeout(this.adPauseTimeoutId),this.timeSpent>0&&(this.setHeartbeatInterval(e),this.startTime=t),this.adCount+=1,this.adStartTime>0&&(this.adTimeSpent+=t-this.adStartTime),this.dispatch(e,!0),this.dispatch(Object.assign(Object.assign({},e),{event_name:"media_ad_stop"}),!0),this.adStartTime=0;break;case"media_ad_start":this.createMediaSession(e),this.setAdHeartbeatInterval(e),this.startTime>0&&(window.clearInterval(this.heartbeatIntervalId),this.timeSpent+=t-this.startTime,this.startTime=0),this.adStartTime=t,this.dispatch(e,!0);break;case"media_ad_stop":if(!this.sessionId)return;window.clearInterval(this.adHeartbeatIntervalId),window.clearTimeout(this.adPauseTimeoutId),this.timeSpent>0&&(this.setHeartbeatInterval(e),this.startTime=t),this.adCount+=1,this.adStartTime>0&&(this.adTimeSpent+=t-this.adStartTime),this.dispatch(e,!0),this.adStartTime=0;break;case"media_backward":if(!this.sessionId||0===this.startTime)return;this.timeSpent+=t-this.startTime,this.startTime=t,this.dispatch(e);break;case"media_buffer_end":case"media_buffer_start":case"media_forward":if(!this.sessionId)return;this.timeSpent+=t-this.startTime,this.startTime=t,this.dispatch(e);break;case"media_dispose_ad_stop":if(window.clearInterval(this.adHeartbeatIntervalId),window.clearInterval(this.heartbeatIntervalId),window.clearTimeout(this.adPauseTimeoutId),0===this.adStartTime)return;e.event_name="media_ad_stop",this.adCount+=1,this.adTimeSpent+=t-this.adStartTime,this.dispatch(e,!0),this.adTimeSpent=0,this.previousAdTimeSpent=0,this.timeSpent=0,this.previousTimeSpent=0,this.startTime=0,this.sessionId=void 0;break;case"media_pause":if(!this.sessionId||0===this.startTime)return;window.clearInterval(this.heartbeatIntervalId),this.setPauseTimeout(e),this.timeSpent+=t-this.startTime,this.startTime=0,this.dispatch(e);break;case"media_play":window.clearTimeout(this.pauseTimeoutId),this.createMediaSession(e),this.setHeartbeatInterval(e),this.startTime=t,this.dispatch(e);break;case"media_start":this.createMediaSession(e),this.setHeartbeatInterval(e),this.startTime=t,this.dispatch(e);break;case"media_stop":if(window.clearInterval(this.heartbeatIntervalId),window.clearTimeout(this.pauseTimeoutId),!this.sessionId)return;this.startTime>0&&(this.timeSpent+=t-this.startTime),this.adCount=1,this.dispatch(e),this.adTimeSpent=0,this.previousAdTimeSpent=0,this.timeSpent=0,this.previousTimeSpent=0,this.startTime=0,this.sessionId=void 0}}setAdHeartbeatInterval(e){window.clearInterval(this.adHeartbeatIntervalId);const t=JSON.stringify(e);this.adHeartbeatIntervalId=window.setInterval((()=>{const e=JSON.parse(t),i=Date.now()-this.adStartTime+this.adTimeSpent;e.event_name="media_ad_heartbeat",e.media_current_position=void 0,i>12e4*this.adCount?(window.clearInterval(this.adHeartbeatIntervalId),this.adTimeSpent=i,this.dispatchMediaAdStop(t)):this.dispatch(e,!0,i)}),1e3*this.config.mediaAdHeartbeatSec)}setAdPauseTimeout(e){window.clearTimeout(this.adPauseTimeoutId),this.adPauseTimeoutId=window.setTimeout((()=>this.dispatchMediaAdStop(JSON.stringify(e))),1e3*this.config.mediaPauseTimeoutSec)}setHeartbeatInterval(e){window.clearInterval(this.heartbeatIntervalId);const t=JSON.stringify(e);this.heartbeatIntervalId=window.setInterval((()=>{const e=JSON.parse(t),i=Date.now()-this.startTime+this.timeSpent;e.event_name="media_heartbeat",e.media_current_position=void 0,e.media_content_length&&i>2*e.media_content_length*1e3?(window.clearInterval(this.heartbeatIntervalId),this.timeSpent=i,this.dispatchMediaStop(t)):this.dispatch(e,!1,i)}),1e3*this.getHeartbeatInterval(e))}setPauseTimeout(e){window.clearTimeout(this.pauseTimeoutId),this.pauseTimeoutId=window.setTimeout((()=>this.dispatchMediaStop(JSON.stringify(e))),1e3*this.config.mediaPauseTimeoutSec)}}let a;const r=e=>null==e||""===e||"null"===e||"undefined"===e||"object"==typeof e&&0===Object.keys(e).length,o=e=>"object"==typeof e&&null!=e&&"event_name"in e,c=e=>!isNaN(e)&&e instanceof Date,d={ad_id:"ad1",ad_creative:"ad2",ad_type:"ad3",ad_placement:"ad4",ad_orientation:"ad6",ad_destination_url:"ad7",ad_version:"ad8",ad_parent_type:"ad9",ad_parent_id:"ad10",ad_pod_number:"ad11",ad_pod_size:"ad12",api_url:"ap1",api_method:"ap2",api_response_time:"ap3",article_id:"ar1",article_id_source:"ar2",article_name:"ar3",event_name:"e2",event_instance_id:["e3",!0],event_session_sequence_num:["e4",!0],event_timestamp:"e6",event_log_timestamp:["e7",!0],event_test:"e10",funnel_type:"fn1",funnel_name:"fn2",funnel_milestone:"fn3",impression_id:"imp1",impression_id_source:"imp2",impression_type:"imp3",link_module_name:"l1",link_module_position:"l2",link_name:"l4",link_position:"l5",link_destination_location:"l7",link_destination_url:"l8",media_id:"m1",media_id_source:"m2",media_name:"m3",media_observed_bitrate:"m5",media_content_length:"m6",media_current_position:"m7",media_current_chapter:"m8",media_player_name:"m9",media_player_type:"m10",media_player_version:"m11",media_session_id:"m12",media_subtitle_language:"m16",media_audio_language:"m18",media_video_type:"m20",media_playlist_id:"m24",media_ad_id:"m26",media_ad_id_source:"m27",media_time_spent:"m28",media_ad_time_spent:"m29",media_live:"m30",media_viewing_mode:"m31",media_channel:"m32",media_air_date:"m33",media_air_time:"m34",media_airing_id:"m35",media_program_code:"m36",media_segment:"m37",media_sport:"m38",media_league:"m39",media_start_type:"m40",media_network_name:"m41",media_is_mute:"m42",media_live_scoring:"m43",media_autoplay_sound:"m45",media_video_type_detail:"m46",media_show_code:"m47",media_play_location:"m48",media_binge_play_count:"m53",page_location:["p1",!1,!0],page_url:["p2",!1,!0],page_id:["p3",!1,!0],page_id_source:["p4",!1,!0],page_instance_id:["p5",!1,!0],page_previous_url:["p6",!0,!0],page_z_axis:"p7",page_version:"p8",page_type:["p9",!1,!0],page_time_spent:"p10",page_user_mode:"p11",page_auth_flag:"p12",page_nav_method:"p13",page_premium_content:"p14",pzncon_event:"pc1",pzncon_personalized:"pc2",pzncon_curated:"pc3",pzncon_reason:"pc4",pzncon_rule:"pc5",pzncon_edition:"pc6",pzncon_slot_position:"pc7",pzncon_presentation_type:"pc8",pzncon_content_id:"pc9",pzncon_content_id_type:"pc10",pzncon_nav_method:"pc11",pzncon_clubhouse:"pc12",pzncon_feed_version:"pc13",pzncon_content_score:"pc14",pzncon_entitled:"pc15",pzncon_collection_id:"pc16",pzncon_collection_id_type:"pc17",pzncon_personal_metadata:"pc18",pzncon_originally_published:"pc19",pzncon_last_modified:"pc20",pzncon_content_title:"pc21",pzncon_personal_metadata_ids:"pc22",pzncon_premium:"pc23",pzncol_collection_id:"pcl1",pzncol_collection_id_type:"pcl2",pzncol_content_id:"pcl3",pznfav_event:"pf1",pznfav_entity_id:"pf2",pznfav_entity_type:"pf3",prompt_view:"pr1",prompt_input:"pr2",payment_id:"py1",payment_category:"py2",payment_balance:"py3",payment_type:"py4",payment_sub_type:"py5",payment_currency:"py6",payment_country:"py7",payment_amount:"py8",payment_partner:"py9",payment_item:"py10",payment_item_count:"py11",payment_pay_wall_shown:"py12",payment_program_data:"py13",registration_guest_id:"r1",registration_guest_id_domain:"r2",registration_flow:"r3",registration_step:"r4",state_cmp:["s1",!1,!0],state_test:["s2",!1,!0],state_orientation:["s3",!0],session_id:["se1",!0],session_language:["se2",!0],session_first_page:["se3",!0],session_first_url:["se4",!0],session_first_referrer_url:["se5",!0],session_start_timestamp:["se9",!0],session_total_time:["se10",!0],search_module:"sr1",search_type:"sr2",search_keyword_executed:"sr3",search_keyword_typed:"sr4",search_refinement:"sr5",search_results_count:"sr6"},l={app_bundle_id:["a1",!0],app_suite:["a2",!0],app_platform:["a3",!0],app_version:["a4",!0],app_logging_lib_version:["a5",!0],app_region:["a6",!0],app_country:["a7",!0],app_network:["a8",!0],app_zipcode:["a10",!0],app_id:["a11",!0],browser_height:["br2",!0],browser_width:["br3",!0],browser_cookies_flag:["br4",!0],browser_local_storage_flag:["br5",!0],browser_java_flag:["br6",!0],browser_plugins:["br8",!0],browser_flash_version:["br9",!0],device_height:["d5",!0],device_width:["d6",!0],device_advertiser_id:["d13",!0,!0],user_guest_id:["u1",!0],user_affiliate:["u2",!0,!0],user_mvpd_short_name:["u3",!0,!0],user_mvpd_name:["u4",!0,!0],user_subscriber_type:["u5",!0,!0],user_access_method:["u6",!0,!0],user_disney_plus_bundle:["u7",!0,!0],user_anonymous_id:["u8",!0],user_subscription_id:["u9",!0,!0],user_dss_id:["u10",!0,!0]},h={app_bundle_id:"",app_id:"",app_platform:"",app_suite:"",app_version:"",collection:!0,compression:"none",disableAppVersions:"",disableMediaAppVersions:"",disableMediaSdkVersions:"",disableSdkVersions:"",flushAtEventCount:10,flushIntervalSec:60,mediaAdHeartbeatSec:5,mediaCollection:!0,mediaHeartbeatLongSec:20,mediaHeartbeatMediumSec:10,mediaHeartbeatShortSec:5,mediaLengthMediumSec:3600,mediaLengthShortSec:90,mediaPauseTimeoutSec:600,pageActiveThreshold:120,pageHeartbeatCollection:!1,pageHeartbeatInSeconds:60,pollConfigIntervalSec:600,privacy:!1,url:""},u={guestIds:[],lastHeartbeat:0,libVersion:"11.0.0"},_="vision";class p{constructor(){this.events={}}publish(e,...t){var i;null===(i=this.events[e])||void 0===i||i.forEach((e=>e(...t)))}subscribe(e,t){Array.isArray(this.events[e])||(this.events[e]=[]),this.events[e].push(t);const i=this.events[e].length-1;return()=>this.events[e].splice(i,1)}}class m{constructor(e){this.store=e}log(e,t="Debug"){this.store.getState().debugMode&&console.log(`VISION Log (${t}):`,e)}}class v{constructor(e,t,i,s){this.eventBus=e,this.storage=t,this.store=i,this.lastEvent=0,e.subscribe("client.unset-force-disable-collection",(()=>this.create())),s.subscribe((()=>{this.config=s.getState();const{pageHeartbeatInSeconds:e}=this;this.pageHeartbeatInSeconds=this.config.pageHeartbeatInSeconds,null!=this.heartbeatIntervalId&&e!==this.pageHeartbeatInSeconds&&this.setHeartbeatInterval()})),this.config=s.getState(),this.pageHeartbeatInSeconds=this.config.pageHeartbeatInSeconds}create(){const t=Date.now(),i={active:t+18e5,event_session_sequence_num:0,expires:t+432e5,session_id:e(),session_start_timestamp:t,session_total_time:0,vision_id:e()};return this.storage.setLocalItem("visionSession",i),i}createAnonId(){const t={expires:Date.now()+33927469800,user_anonymous_id:e()};return this.storage.setLocalItem("visionAnonId",t),t}extend(){const e=this.readOrCreate(),t=Date.now();e.expires-t>0&&e.active-t>0?this.storage.setLocalItem("visionSession",Object.assign(Object.assign({},e),{active:t+18e5})):this.create()}readOrCreate(){const e=this.storage.getLocalItem("visionSession");return null!=e?e:this.create()}readOrCreateAnonId(){const e=this.storage.getLocalItem("visionAnonId");return null!=e&&e.expires-Date.now()>0?e:this.createAnonId()}run(){this.eventBus.subscribe("tracking.activity",(()=>{this.extend(),this.touchLastEvent()})),this.eventBus.subscribe("tracking.page",(e=>this.updatePageProperties(e))),window.addEventListener("pagehide",(()=>this.updateTimeSpent())),window.document.addEventListener("scroll",(()=>this.touchLastEvent())),this.setHeartbeatInterval(),this.readOrCreateAnonId(),this.extend(),this.touchLastEvent(),this.store.setState({lastHeartbeat:Date.now()})}setHeartbeatInterval(){window.clearInterval(this.heartbeatIntervalId),this.heartbeatIntervalId=window.setInterval((()=>{this.updateTimeSpent((()=>{Date.now()-this.lastEvent<1e3*this.config.pageActiveThreshold?this.config.pageHeartbeatCollection&&this.eventBus.publish("session.page-heartbeat"):(this.eventBus.publish("session.page-close"),this.lastEvent=0)}))}),1e3*this.config.pageHeartbeatInSeconds)}touchLastEvent(){this.lastEvent=Date.now()}update(e){const t=this.readOrCreate(),i=Object.keys(e).reduce(((i,s)=>{const n=e[s];return i[s]="function"==typeof n?n(t[s]):n,i}),{});this.storage.setLocalItem("visionSession",Object.assign(Object.assign({},t),i))}updatePageProperties(e){const t=this.storage.getLocalItem("visionSession"),i={};if(!(null==t?void 0:t.session_first_referrer_url)){const e=this.storage.getSessionItem("visionPagePreviousUrl");e&&(i.session_first_referrer_url=e)}if(e.page_location&&!(null==t?void 0:t.session_first_page)&&(i.session_first_page=e.page_location),e.page_url&&!(null==t?void 0:t.session_first_url)&&(i.session_first_url=e.page_url),Object.keys(i).length>0&&this.update(i),"page_view"===e.event_name&&e.page_url){const e=this.storage.getSessionItem("visionPageUrl");e&&this.storage.setSessionItem("visionPagePreviousUrl",e)}}updateTimeSpent(e){const t=Date.now(),i=t-this.store.getState().lastHeartbeat;this.lastEvent>0&&i>0&&i<=1.1*this.config.pageHeartbeatInSeconds*1e3&&(null==e||e(),this.update({session_total_time:e=>e+i/1e3})),this.store.setState({lastHeartbeat:t})}}class g{constructor(){this.memo={},this.getLocalItem=g.createGetter("localStorage"),this.getSessionItem=g.createGetter("sessionStorage"),this.removeLocalItem=g.createRemover("localStorage"),this.removeSessionItem=g.createRemover("sessionStorage"),this.setLocalItem=g.createSetter("localStorage"),this.setSessionItem=g.createSetter("sessionStorage")}static createGetter(e){return function(t){if(this.isAvailable(e))try{return JSON.parse(window[e].getItem(t))}catch(i){return window[e].getItem(t)}}}static createRemover(e){return function(t){this.isAvailable(e)&&window[e].removeItem(t)}}static createSetter(e){return function(t,i){this.isAvailable(e)&&window[e].setItem(t,JSON.stringify(i))}}isAvailable(e){if(null==this.memo[e])try{const t=window[e],i="__storage_test__";t.setItem(i,i),t.removeItem(i),this.memo[e]=!0}catch(t){this.memo[e]=!1}return this.memo[e]}}class f{constructor(e){this.initialState=e,this.listeners=new Set,this.state=e}getInitialState(){return this.initialState}getState(){return this.state}setState(e){const t="function"==typeof e?e(this.state):e;if(t===this.state)return;const i=this.state;this.state="object"==typeof t&&null!=t?Object.assign(Object.assign({},this.state),t):t,this.listeners.forEach((e=>e(this.state,i)))}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}}const b=()=>{const e=window.navigator.plugins["Shockwave Flash 2.0"]||window.navigator.plugins["Shockwave Flash"],t=window.navigator.userAgent.toLowerCase();return`flash_version:${e?(e=>{const t=e.description.split(" "),[i,s]=t[2].split("."),n=""!==t[3]?t[3]:t[4];return[i,s,"d"===n[0]?n.slice(1):"r"===n[0]?n.replace(/^r(.?[^d]*).*/,"$1"):n].join(".")})(e):t.indexOf("webtv/2.6")>-1?"4":t.indexOf("webtv/2.5")>-1?"3":t.indexOf("webtv")>-1?"2":S()?(()=>{try{return new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash.7").GetVariable("$version")}catch(e){}try{const e=new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");return e.AllowScriptAccess="always",e.GetVariable("$version")}catch(e){}try{return new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"),"WIN 6,0,21,0"}catch(e){}try{return new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash.3").GetVariable("$version")}catch(e){}try{return new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash.3"),"WIN 3,0,18,0"}catch(e){}try{return new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash"),"WIN 2,0,0,11"}catch(e){}return"-1"})():"-1"}`},S=()=>window.navigator.appVersion.indexOf("MSIE")>-1&&window.navigator.appVersion.toLowerCase().indexOf("win")>-1&&-1===window.navigator.userAgent.indexOf("Opera");class w{constructor(e,t,i){this.storage=e,this.store=t,i.subscribe((()=>this.config=i.getState())),this.config=i.getState()}app_bundle_id(){return this.config.app_bundle_id}app_country(){return this.config.app_country}app_id(){return this.config.app_id}app_logging_lib_version(){return this.store.getState().libVersion}app_network(){return this.config.app_network}app_platform(){return this.config.app_platform}app_region(){return this.config.app_region}app_suite(){return this.config.app_suite}app_version(){return this.config.app_version}app_zipcode(){return this.config.app_zipcode}browser_cookies_flag(){return window.navigator.cookieEnabled}browser_flash_version(){return b()}browser_height(){return Math.floor(window.innerHeight||window.document.body.clientHeight)}browser_local_storage_flag(){return this.storage.isAvailable("localStorage")}browser_java_flag(){return"function"==typeof window.navigator.javaEnabled&&window.navigator.javaEnabled()}browser_plugins(){var e;if(null!=(null===(e=window.navigator.plugins)||void 0===e?void 0:e.length))return Array.prototype.map.call(window.navigator.plugins,(e=>e.name)).join(";")}browser_width(){return Math.floor(window.innerWidth||window.document.body.clientWidth)}device_height(){return Math.floor(window.screen.height)}device_width(){return Math.floor(window.screen.width)}event_instance_id(){return e()}event_log_timestamp(){return Date.now()}event_session_sequence_num(){const e=this.storage.getLocalItem("visionSession");if(null!=e)return e.event_session_sequence_num+=1,this.storage.setLocalItem("visionSession",e),e.event_session_sequence_num}event_timestamp(e){return(null==e?void 0:e.event_timestamp)||Date.now()}pzncon_last_modified(e){const t=new Date(null==e?void 0:e.pzncon_last_modified);return c(t)?t.getTime():void 0}pzncon_originally_published(e){const t=new Date(null==e?void 0:e.pzncon_originally_published);return c(t)?t.getTime():void 0}session_first_page(){var e;return null===(e=this.storage.getLocalItem("visionSession"))||void 0===e?void 0:e.session_first_page}session_first_referrer_url(){var e;return null===(e=this.storage.getLocalItem("visionSession"))||void 0===e?void 0:e.session_first_referrer_url}session_first_url(){var e;return null===(e=this.storage.getLocalItem("visionSession"))||void 0===e?void 0:e.session_first_url}session_id(){var e;return null===(e=this.storage.getLocalItem("visionSession"))||void 0===e?void 0:e.session_id}session_language(){return window.navigator.language||window.navigator.browserLanguage}session_start_timestamp(){var e;return null===(e=this.storage.getLocalItem("visionSession"))||void 0===e?void 0:e.session_start_timestamp}session_total_time(){var e;const t=Date.now()-this.store.getState().lastHeartbeat,i=t>0&&t<=1.1*this.config.pageHeartbeatInSeconds*1e3,s=(null===(e=this.storage.getLocalItem("visionSession"))||void 0===e?void 0:e.session_total_time)||0;return i?s+t/1e3:s}state_cmp(e){return(null==e?void 0:e.state_cmp)||(t="cmp",window.document.location.search.slice(1).split("&").reduce(((e,i)=>{const[s,n]=i.split("=");return null!=e||s!==t?e:null==n?"":decodeURIComponent(n)}),null));var t}state_orientation(){return window.matchMedia("(orientation: landscape)").matches?"landscape":"portrait"}user_anonymous_id(){var e;return null===(e=this.storage.getLocalItem("visionAnonId"))||void 0===e?void 0:e.user_anonymous_id}user_guest_id(){return this.store.getState().guestIds.map((e=>Object.assign({},e)))}}class I{constructor(e,t,i,s,n){this.eventBus=e,this.storage=t,this.store=i,this.xhr=s,n.subscribe((()=>{this.config=n.getState();const{flushIntervalSec:e}=this;this.flushIntervalSec=this.config.flushIntervalSec,null!=this.flushIntervalId&&e!==this.flushIntervalSec&&this.setFlushInterval()})),this.config=n.getState(),this.flushIntervalSec=this.config.flushIntervalSec,this.trackingModel=new w(t,i,n)}anonymize(e){const t=["a6","a7","a10","d13","u1","u2","u8","u10"],i=["se2"];Object.keys(e.global).forEach((i=>{t.indexOf(i)>-1&&delete e.global[i]})),null!=e.global.u9&&e.global.u9.forEach((e=>{delete e.id})),e.events.forEach((e=>{e.s4=!0,Object.keys(e).forEach((t=>{i.indexOf(t)>-1&&delete e[t]}))}))}batchEvents(e){(e=[...(this.storage.getLocalItem("visionEvents")||[]).filter(this.isEventData),...e]).length>=this.config.flushAtEventCount?(this.xhr.postEvents(this.createPayload(e)),this.storage.removeLocalItem("visionEvents")):this.storage.setLocalItem("visionEvents",e)}createEventData(e){return e.map((e=>this.mapProperties(d,e)))}createPayload(e){const t={global:this.mapProperties(l),events:e};return(this.config.privacy||this.storage.getSessionItem("visionStatePrivacy"))&&this.anonymize(t),t}handleEvents(e){if(this.isCollectionDisabled())return;const{eventsToBatch:t,eventsToPost:i,isActivity:s}=e.reduce(((e,t)=>{if(/^media_/.test(t.event_name))return e;this.eventBus.publish("tracking.page",t);const i="pzncon"===t.event_name?"eventsToBatch":"eventsToPost";return e.isActivity=e.isActivity||-1===["page_close","page_heartbeat"].indexOf(t.event_name),e[i].push(t),e}),{eventsToBatch:[],eventsToPost:[],isActivity:!1});s&&this.eventBus.publish("tracking.activity"),i.length>0&&this.xhr.postEvents(this.createPayload(this.createEventData(i))),t.length>0&&this.batchEvents(this.createEventData(t))}isCollectionDisabled(){return!this.config.collection||i(this.store.getState().libVersion,this.config.disableSdkVersions)||i(this.config.app_version,this.config.disableAppVersions)||!!this.storage.getLocalItem("visionForceDisableCollection")}isMediaCollectionDisabled(){return!this.config.mediaCollection||i(this.store.getState().libVersion,this.config.disableMediaSdkVersions)||i(this.config.app_version,this.config.disableMediaAppVersions)||this.isCollectionDisabled()}mapProperties(e,t){const i=Object.assign({},t),s=Object.keys(e).reduce(((s,n)=>{const a=e[n],[o,c,d]=Array.isArray(a)?a:[a,!1];let l;if(c||(l=null==t?void 0:t[n],delete i[n]),"function"==typeof this.trackingModel[n]&&(l=this.trackingModel[n](t)),d){const e=`vision${(e=>e.split("_").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(""))(n)}`;r(l)?l=this.storage.getSessionItem(e):this.storage.setSessionItem(e,l)}return!r(l)&&(s[o]=l),s}),{}),n=Object.keys(i).reduce(((e,t)=>(!r(i[t])&&(e[t]=i[t]),e)),{});return!r(n)&&(s.unmapped=n),s}isEventData(e){const t="e2"in e;return t&&Object.keys(e).forEach((t=>r(e[t])&&delete e[t])),t}postBatch(){const e=(this.storage.getLocalItem("visionEvents")||[]).filter(this.isEventData);e.length&&!this.isCollectionDisabled()&&(this.xhr.postEvents(this.createPayload(e)),this.storage.removeLocalItem("visionEvents"))}postMedia(e){this.isMediaCollectionDisabled()||(this.eventBus.publish("tracking.page",e),this.eventBus.publish("tracking.activity"),this.xhr.postEvents(this.createPayload(this.createEventData([e])),!0))}run(){this.eventBus.subscribe("session.page-close",(()=>this.handleEvents([{event_name:"page_close"}]))),this.eventBus.subscribe("session.page-heartbeat",(()=>this.handleEvents([{event_name:"page_heartbeat"}]))),this.setFlushInterval()}setFlushInterval(){window.clearInterval(this.flushIntervalId),this.flushIntervalId=window.setInterval((()=>this.postBatch()),1e3*this.flushIntervalSec)}}function y(e,t,i,s){return new(i||(i=Promise))((function(n,a){function r(e){try{c(s.next(e))}catch(e){a(e)}}function o(e){try{c(s.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}c((s=s.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const T=new g;class A{constructor(e,t){if(this._activated=!1,this._fetchIntervalSec=600,this._fetchTimestamp=-1,this._lastFetchStatus="no-fetch-yet","object"!=typeof e||null==e)throw new TypeError("VISION Configurator: default config argument is invalid");if("object"!=typeof t&&null!=t)throw new TypeError("VISION Configurator: settings argument is invalid");const{fetchIntervalSec:i,sdk:s,url:n}=null!=t?t:{};this._settings={debug:!!(null==t?void 0:t.debug),sdk:"",url:""},this._store=new f(e),"number"==typeof i&&(this._fetchIntervalSec=i>60?i:60),"string"==typeof s&&(this._settings.sdk=s),"string"==typeof n&&/^https?:\/\//.test(n)&&(this._settings.url=n),this._promise=new Promise((e=>this._resolve=e)).then((()=>{this._activated=!0}))}get activated(){return this._activated}get defaultConfig(){return this._store.getInitialState()}ensureActivated(){return y(this,void 0,void 0,(function*(){yield this._promise}))}fetchConfig(){return y(this,void 0,void 0,(function*(){var e;if(null!=this._fetchIntervalId)return;if(!this._validates())return void console.error(new Error("VISION Configurator: settings are invalid"));this._store.subscribe((e=>{const{_fetchIntervalSec:t}=this,i="pollConfigIntervalSec"in e?e.pollConfigIntervalSec:void 0;"number"==typeof i&&(this._fetchIntervalSec=i>60?i:60),null!=this._fetchIntervalId&&t!==this._fetchIntervalSec&&this._setFetchInterval()}));const t=T.getLocalItem(`${this._settings.sdk}ConfigTimestamp`);"number"==typeof t&&(Date.now()-t)/1e3<this._fetchIntervalSec?(this._store.setState(T.getLocalItem(`${this._settings.sdk}Configuration`)||{}),null===(e=this._resolve)||void 0===e||e.call(this)):yield this._fetchRemote(),this._setFetchInterval()}))}_fetchRemote(){return y(this,arguments,void 0,(function*(e=!0){var i,s,n;if(!T.getLocalItem("visionForceDisableCollection"))if(this._validates())try{let e;if(this._settings.url.startsWith("https://vision.fn-pz")){const s=(null===(i=T.getLocalItem("visionSession"))||void 0===i?void 0:i.session_id)||"";e={credentials:"include",headers:{Authorization:t(s,_),"Session-Id":s}}}const a=yield window.fetch(this._settings.url,e),r=a.ok?null===(s=yield a.json())||void 0===s?void 0:s.config:void 0;if(!a.ok)throw new Error(yield a.text());if("object"!=typeof r||null==r)throw new TypeError("config is invalid");this._lastFetchStatus="success",this._fetchTimestamp=Date.now(),T.setLocalItem(`${this._settings.sdk}ConfigTimestamp`,this._fetchTimestamp),T.setLocalItem(`${this._settings.sdk}Configuration`,r),this._store.setState(r),this._activated||null===(n=this._resolve)||void 0===n||n.call(this),this._settings.debug&&console.log("VISION Configurator:",r)}catch(t){if(e)return void(yield this._fetchRemote(!1));this._lastFetchStatus="failure",this._settings.debug&&console.log("VISION Configurator:",t)}else console.error(new Error("VISION Configurator: settings are invalid"))}))}get fetchTimestamp(){return this._fetchTimestamp}getAll(){return this._store.getState()}getValue(e){return this._store.getState()[e]}get lastFetchStatus(){return this._lastFetchStatus}_setFetchInterval(){window.clearInterval(this._fetchIntervalId),this._fetchIntervalId=window.setInterval((()=>this._fetchRemote()),1e3*this._fetchIntervalSec)}get settings(){return this._settings}get store(){return this._store}subscribe(e){return this._store.subscribe(e)}_validates(){const{sdk:e,url:t}=this._settings;return"string"==typeof e&&!!e&&"string"==typeof t&&/^https?:\/\//.test(t)}}var k,E={},O={};function C(){if(k)return O;k=1;var e=[0,255,65535,16777215,4294967295];function t(e,t,i,s,n){var a;for(a=0;a<n;a++)i[s+a]=e[t+a]}function i(e,t,i,s){var n;for(n=0;n<s;n++)e[t+n]=e[t-i+n]}function s(e){this.array=e,this.pos=0}return s.prototype.readUncompressedLength=function(){for(var e,t,i=0,s=0;s<32&&this.pos<this.array.length;){if(e=this.array[this.pos],this.pos+=1,(t=127&e)<<s>>>s!==t)return-1;if(i|=t<<s,e<128)return i;s+=7}return-1},s.prototype.uncompressToBuffer=function(s){for(var n,a,r,o,c=this.array,d=c.length,l=this.pos,h=0;l<c.length;)if(n=c[l],l+=1,3&n){switch(3&n){case 1:a=4+(n>>>2&7),o=c[l]+(n>>>5<<8),l+=1;break;case 2:if(l+1>=d)return!1;a=1+(n>>>2),o=c[l]+(c[l+1]<<8),l+=2;break;case 3:if(l+3>=d)return!1;a=1+(n>>>2),o=c[l]+(c[l+1]<<8)+(c[l+2]<<16)+(c[l+3]<<24),l+=4}if(0===o||o>h)return!1;i(s,h,o,a),h+=a}else{if((a=1+(n>>>2))>60){if(l+3>=d)return!1;r=a-60,a=1+((a=c[l]+(c[l+1]<<8)+(c[l+2]<<16)+(c[l+3]<<24))&e[r]),l+=r}if(l+a>d)return!1;t(c,l,s,h,a),l+=a,h+=a}return!0},O.SnappyDecompressor=s,O}var H,M,D={};var L,U=function(){if(M)return E;function e(){return"object"==typeof process&&"object"==typeof process.versions&&void 0!==process.versions.node}function t(t){return t instanceof Uint8Array&&(!e()||!Buffer.isBuffer(t))}function i(e){return e instanceof ArrayBuffer}function s(t){return!!e()&&Buffer.isBuffer(t)}M=1;var n=C().SnappyDecompressor,a=function(){if(H)return D;H=1;var e=new Array(15);function t(e,t){return 506832829*e>>>t}function i(e,t){return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)}function s(e,t,i){return e[t]===e[i]&&e[t+1]===e[i+1]&&e[t+2]===e[i+2]&&e[t+3]===e[i+3]}function n(e,t,i,s,n){return i<=60?(s[n]=i-1<<2,n+=1):i<256?(s[n]=240,s[n+1]=i-1,n+=2):(s[n]=244,s[n+1]=i-1&255,s[n+2]=i-1>>>8,n+=3),function(e,t,i,s,n){var a;for(a=0;a<n;a++)i[s+a]=e[t+a]}(e,t,s,n,i),n+i}function a(e,t,i,s){return s<12&&i<2048?(e[t]=1+(s-4<<2)+(i>>>8<<5),e[t+1]=255&i,t+2):(e[t]=2+(s-1<<2),e[t+1]=255&i,e[t+2]=i>>>8,t+3)}function r(e,t,i,s){for(;s>=68;)t=a(e,t,i,64),s-=64;return s>64&&(t=a(e,t,i,60),s-=60),a(e,t,i,s)}function o(a,o,c,d,l){for(var h=1;1<<h<=c&&h<=14;)h+=1;var u=32-(h-=1);void 0===e[h]&&(e[h]=new Uint16Array(1<<h));var _,p=e[h];for(_=0;_<p.length;_++)p[_]=0;var m,v,g,f,b,S,w,I,y,T,A=o+c,k=o,E=o,O=!0;if(c>=15)for(m=A-15,g=t(i(a,o+=1),u);O;){S=32,f=o;do{if(v=g,w=S>>>5,S+=1,f=(o=f)+w,o>m){O=!1;break}g=t(i(a,f),u),b=k+p[v],p[v]=o-k}while(!s(a,o,b));if(!O)break;l=n(a,E,o-E,d,l);do{for(I=o,y=4;o+y<A&&a[o+y]===a[b+y];)y+=1;if(o+=y,l=r(d,l,I-b,y),E=o,o>=m){O=!1;break}p[t(i(a,o-1),u)]=o-1-k,b=k+p[T=t(i(a,o),u)],p[T]=o-k}while(s(a,o,b));if(!O)break;g=t(i(a,o+=1),u)}return E<A&&(l=n(a,E,A-E,d,l)),l}function c(e){this.array=e}return c.prototype.maxCompressedLength=function(){var e=this.array.length;return 32+e+Math.floor(e/6)},c.prototype.compressToBuffer=function(e){var t,i=this.array,s=i.length,n=0,a=0;for(a=function(e,t,i){do{t[i]=127&e,(e>>>=7)>0&&(t[i]+=128),i+=1}while(e>0);return i}(s,e,a);n<s;)a=o(i,n,t=Math.min(s-n,65536),e,a),n+=t;return a},D.SnappyCompressor=c,D}().SnappyCompressor,r="Argument compressed must be type of ArrayBuffer, Buffer, or Uint8Array";return E.uncompress=function(e,a){if(!t(e)&&!i(e)&&!s(e))throw new TypeError(r);var o=!1,c=!1;t(e)?o=!0:i(e)&&(c=!0,e=new Uint8Array(e));var d,l,h=new n(e),u=h.readUncompressedLength();if(-1===u)throw new Error("Invalid Snappy bitstream");if(u>a)throw new Error(`The uncompressed length of ${u} is too big, expect at most ${a}`);if(o){if(d=new Uint8Array(u),!h.uncompressToBuffer(d))throw new Error("Invalid Snappy bitstream")}else if(c){if(d=new ArrayBuffer(u),l=new Uint8Array(d),!h.uncompressToBuffer(l))throw new Error("Invalid Snappy bitstream")}else if(d=Buffer.alloc(u),!h.uncompressToBuffer(d))throw new Error("Invalid Snappy bitstream");return d},E.compress=function(e){if(!t(e)&&!i(e)&&!s(e))throw new TypeError(r);var n=!1,o=!1;t(e)?n=!0:i(e)&&(o=!0,e=new Uint8Array(e));var c,d,l,h=new a(e),u=h.maxCompressedLength();if(n?(c=new Uint8Array(u),l=h.compressToBuffer(c)):o?(c=new ArrayBuffer(u),d=new Uint8Array(c),l=h.compressToBuffer(d)):(c=Buffer.alloc(u),l=h.compressToBuffer(c)),!c.slice){var _=new Uint8Array(Array.prototype.slice.call(c,0,l));if(n)return _;if(o)return _.buffer;throw new Error("Not implemented")}return c.slice(0,l)},E}();class j{constructor(e,t,i){this.logger=e,this.storage=t,i.subscribe((()=>this.config=i.getState())),this.config=i.getState()}setHeaders(e,i,s=!1){const n=this.storage.getLocalItem("visionSession"),a=t(n.session_id,_);e.setRequestHeader("App-Id",this.config.app_id),e.setRequestHeader("Authorization",a),e.setRequestHeader("Session-Id",n.session_id),e.setRequestHeader("Suite",this.config.app_suite),e.setRequestHeader("Vauth",a),e.setRequestHeader("Vision-Id",n.vision_id),null!=i&&(e.setRequestHeader("Accept","application/json"),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Event-Count",i.events.length.toString()),this.config.debugMode||"snappy"!==this.config.compression||e.setRequestHeader("Content-Encoding","snappy"),s&&"string"==typeof i.events[0].m12&&(e.setRequestHeader("Event-Type",i.events[0].e2),e.setRequestHeader("Media-Session-Id",i.events[0].m12)))}postEvents(e,t=!1,i=!0){if(0===e.events.length)return;const n=new XMLHttpRequest;n.onreadystatechange=()=>{if(4!==n.readyState)return;const s=n.status>=400&&n.status<=500;s&&i?this.postEvents(e,t,!1):s&&this.logger.log(n.statusText,"Error")},n.open("POST",`${this.config.url.replace(/\/+$/,"")}/${t?"media":"event"}`,!0),n.withCredentials=!0,this.setHeaders(n,e,t);const a=this.config.debugMode||"snappy"!==this.config.compression?JSON.stringify(e):new Blob([U.compress(s(JSON.stringify(e)))],{type:"text/plain"});n.send(a)}}class P{constructor(){var e;this._callQueue=[],this._eventBus=new p,this._isInitialized=!1,this._storage=new g,this._store=new f(u);const{pollConfigIntervalSec:t}=h,i=new A(h,{fetchIntervalSec:t,sdk:"vision"}),s=new m(i.store),n=new j(s,this._storage,i.store);return this._configurator=i,this._logger=s,this._sessionService=new v(this._eventBus,this._storage,this._store,i.store),this._trackingService=new I(this._eventBus,this._storage,this._store,n,i.store),this.constructor._instance=null!==(e=this.constructor._instance)&&void 0!==e?e:this,this.constructor._instance}static _createAdder(e){return this._wrap((function(t,i){const s=this.getInstance(),n=s._storage.getSessionItem(e)||[];!n.some((e=>e.id===t))&&s._storage.setSessionItem(e,[...n,{id:t,s:i}])}))}static _createSetter(e){return this._wrap((function(t){this.getInstance()._storage.setSessionItem(e,t)}))}static _createUnsetter(e,t){return this._wrap((function(i){const s=this.getInstance(),n=s._storage.getSessionItem(e)||[],a=n.filter((e=>e[t]!==i));n.length!==a.length&&s._storage.setSessionItem(e,a)}))}static _createUnsetterAll(e){return this._wrap((function(){this.getInstance()._storage.removeSessionItem(e)}))}static _wrap(e){return function(...t){const i=this.getInstance();i._isInitialized?e.call(this,...t):i._callQueue.push((()=>e.call(this,...t)))}}static getInstance(){var e;return null!==(e=this._instance)&&void 0!==e?e:new this}static setConfigs(t){if("object"!=typeof t||null==t||!t.app_suite||!t.url)return void console.error(new Error("VISION: config argument is invalid"));const i=this.getInstance();i._configurator.settings.debug=!!t.debugMode,i._configurator.settings.url=`${t.url.replace(/\/+$/,"")}/config/${t.app_suite}`,i._configurator.store.setState(t),i._isInitialized||(i._storage.setSessionItem("visionPagePreviousUrl",window.document.referrer||"na"),i._storage.setSessionItem("visionPageInstanceId",e()),i._sessionService.run(),i._configurator.fetchConfig(),i._trackingService.run(),i._callQueue.splice(0,i._callQueue.length).forEach((e=>e())),i._isInitialized=!0)}static setForceDisableCollection(){this.getInstance()._storage.setLocalItem("visionForceDisableCollection",!0)}static unsetForceDisableCollection(){const e=this.getInstance();e._storage.removeLocalItem("visionForceDisableCollection"),e._eventBus.publish("client.unset-force-disable-collection")}}L=P,P.addDssId=L._createAdder("visionUserDssId"),P.addGuestId=L._wrap((function(e,t,i,s){!function(e,t,i){const s=["primary","secondary"].indexOf(i),n=e.getState().guestIds.some((e=>e.id===t.id));if(-1===s&&n)return;const a=e.getState().guestIds.map((e=>Object.assign({},e)));s>-1?a[s]=t:a.push(t),e.setState({guestIds:a})}(this.getInstance()._store,{id:e,l:!!i,s:t},s)})),P.addSubscriptionId=L._wrap((function(e,t){const i=this.getInstance(),s="visionUserSubscriptionId",n=i._storage.getSessionItem(s)||[],[a,r]=null!=t?[t,e]:[e];!n.some((e=>e.id===r&&e.s===a))&&i._storage.setSessionItem(s,[...n,{id:r,s:a}])})),P.addTest=L._createAdder("visionStateTest"),P.setAccessMethod=L._createSetter("visionUserAccessMethod"),P.setAdvertiserId=L._createSetter("visionDeviceAdvertiserId"),P.setAffiliate=L._createSetter("visionUserAffiliate"),P.setDisneyPlusBundle=L._createSetter("visionUserDisneyPlusBundle"),P.setMvpdName=L._createSetter("visionUserMvpdName"),P.setMvpdShortName=L._createSetter("visionUserMvpdShortName"),P.setPrivacy=L._createSetter("visionStatePrivacy"),P.setSubscriberType=L._createSetter("visionUserSubscriberType"),P.unsetAccessMethod=L._createUnsetterAll("visionUserAccessMethod"),P.unsetAdvertiserId=L._createUnsetterAll("visionDeviceAdvertiserId"),P.unsetAffiliate=L._createUnsetterAll("visionUserAffiliate"),P.unsetAllDssId=L._createUnsetterAll("visionUserDssId"),P.unsetAllSubscriptionId=L._createUnsetterAll("visionUserSubscriptionId"),P.unsetAllTest=L._createUnsetterAll("visionStateTest"),P.unsetDisneyPlusBundle=L._createUnsetterAll("visionUserDisneyPlusBundle"),P.unsetDssId=L._createUnsetter("visionUserDssId","id"),P.unsetMvpdName=L._createUnsetterAll("visionUserMvpdName"),P.unsetMvpdShortName=L._createUnsetterAll("visionUserMvpdShortName"),P.unsetPrivacy=L._createUnsetterAll("visionStatePrivacy"),P.unsetSubscriberType=L._createUnsetterAll("visionUserSubscriberType"),P.unsetSubscriptionId=L._createUnsetter("visionUserSubscriptionId","s"),P.unsetTest=L._createUnsetter("visionStateTest","id"),"undefined"!=typeof window&&(window.VisionConfigurator=A);class z extends P{constructor(){super(...arguments),this.track=this.constructor._wrap((e=>{var t;(e=Array.isArray(e)?e:[e],t=e,Array.isArray(t)&&t.every(o))?this._trackingService.handleEvents(e):this._logger.log("Missing property event_name. Event not sent","Error")})).bind(this.constructor)}}class B extends z{constructor(){super(...arguments),this._mediaInstances=[],this.trackMedia=B._wrap((e=>{if(!o(e))return void this._logger.log("Missing property event_name. Event not sent","Error");const t=this._mediaInstances.reduce(((t,{id:i},s)=>-1===t&&i===e.media_id?s:t),-1);if(t>-1){const i="media_pause"===e.event_name&&Math.abs(e.media_content_length-e.media_current_position)<1,{instance:s}=this._mediaInstances[t];this._lastMediaEvent=Object.assign({},e),i&&window.setTimeout((()=>{var e;"media_pause"===(null===(e=this._lastMediaEvent)||void 0===e?void 0:e.event_name)&&(this._lastMediaEvent.event_name="media_stop",s.handleEvent(this._lastMediaEvent))}),2e3),s.handleEvent(e),"media_stop"===e.event_name&&this._mediaInstances.splice(t,1)}else if(["media_ad_start","media_start"].indexOf(e.event_name)>-1){const t=new n((e=>this._trackingService.postMedia(e)),this._configurator.store);this._mediaInstances.push({id:e.media_id,instance:t}),t.handleEvent(e)}})).bind(B)}}return B.videojsPlugin=(e,t,i)=>{let s=!1;const n={},r=function(s){const n=Object.assign(Object.assign({},e.mediainfo),t),r=n.originalPublishDate||n.originalAirDate,o=r&&new Date(r),c=e.muted();a="media_start"===s&&"autostart"===n.startType&&"Autoplay Sound "+(c?"Off":"On")||a;const d={event_name:s,media_ad_id:e.ads&&e.ads.ad&&e.ads.ad.id,media_ad_id_source:n.adIdSource,media_air_date:o?o.toLocaleDateString():void 0,media_air_time:o?o.toLocaleTimeString():void 0,media_airing_id:n.simulcastAiringId||n.airingId,media_audio_language:e.language(),media_autoplay_sound:a,media_binge_play_count:parseInt(n.playlistCount,10)||void 0,media_channel:n.publisher,media_content_length:isFinite(e.duration())&&e.duration()||void 0,media_current_position:e.currentTime(),media_id:n.id,media_id_source:n.webHref,media_is_mute:c,media_league:n.leagueName,media_live:n.live,media_live_scoring:null!=n.liveScoring?"Live Scoring "+(n.liveScoring?"On":"Off"):void 0,media_name:n.headline||n.name,media_network_name:n.publisher,media_observed_bitrate:e.playbackRate(),media_play_location:n.playLocation,media_player_name:e.bcAnalytics&&e.bcAnalytics.settings&&e.bcAnalytics.settings.playerName,media_player_type:e.currentType(),media_player_version:e.bcAnalytics&&e.bcAnalytics.settings&&e.bcAnalytics.settings.platformVersion,media_playlist_id:n.playlistId,media_program_code:n.program,media_segment:n.segment,media_show_code:n.showcode,media_sport:n.sportName,media_start_type:n.startType,media_video_type:n.status||"vod",media_video_type_detail:n.custom_fields&&n.custom_fields.mediaType,media_viewing_mode:e.isFullscreen()?"full screen":"browse"};i(d,n)};e.hasStarted_&&!e.paused()&&(n.started=!0,r("media_start"));e.on("ads-ad-started",(function(){s=!0,r("media_ad_start")})),e.on("ads-ad-ended",(function(){r("media_ad_stop"),s=!1})),e.on("ads-play",(function(){r("media_ad_play")})),e.on("ads-pause",(function(){r("media_ad_pause")})),e.on("ads-ad-skipped",(function(){r("media_ad_skipped"),s=!1})),e.on("playing",(function(){s&&(r("media_ad_stop"),s=!1),n.started||(n.started=!0,r("media_start"))})),e.on("play",(function(){n.started&&n.paused&&(n.paused=!1,r("media_play"))})),e.on("pause",(function(){e.scrubbing()||e.seeking()||n.seeking||(n.paused=!0,r("media_pause"))})),e.on("ended",(function(){r("media_stop"),n.paused=null,n.started=null})),e.on("dispose",(function(){let t;e&&(t="object"==typeof e.ads&&e.ads.isAdPlaying()?"media_dispose_ad_stop":"media_stop",r(t)),n.started=!1})),e.on("seeking",(function(){0!==e.bufferedEnd()||n.buffering||(n.buffering=!0,r("media_buffer_start")),n.seeking=!0})),e.on("seeked",(function(){n.buffering&&(r("media_buffer_end"),n.buffering=!1);const t=parseFloat(n.lastUpdatedTime)<parseFloat(e.currentTime())?"media_forward":"media_backward";r(t),n.seeking=!1})),e.on("timeupdate",(function(){e.scrubbing()||e.seeking()||n.seeking||(n.lastUpdatedTime=e.currentTime())}))},B}));
